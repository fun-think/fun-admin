# Fun-Admin 功能设计和开发计划文档

## 1. 项目概述

Fun-Admin 是一个基于 [go-nunu](https://github.com/go-nunu/nunu) 开发的开源管理后台模板，采用 **Gin + Casbin（RBAC）+ Vue3 + AntDesignVue + AntdvPro** 技术栈，提供快速开发的基础架构。

### 1.1 核心功能
- 权限管理：基于 Casbin 实现 RBAC 角色权限控制，支持接口和菜单粒度控制
- 多数据库支持：支持 MySQL、Postgres、Sqlite 等数据库
- 管理员管理：管理员账号增删改查，密码加密存储
- JWT 认证：提供登录、登出功能
- 前后端分离：RESTful API 设计，支持前后端独立部署
- 一键打包：整站打包为一个可执行二进制文件
- 防呆设计：超管账号始终拥有所有菜单及 API 权限

### 1.2 技术架构
- 后端：采用 Gin + Casbin + GORM 构建 RESTful API
- 前端：Vue3 + Vite + AntdvPro 实现企业级中后台 UI
- 权限模型：RBAC 模型，权限策略存储于数据库
- 部署方式：支持前后端分离部署，或通过 Go 一键打包部署

## 2. 当前实现功能分析

### 2.1 已实现的核心模块

#### 2.1.1 用户认证与授权
- JWT Token 认证机制已实现
- 用户登录、登出功能已完成
- 密码加密存储（bcrypt）已实现
- Casbin RBAC 权限控制已集成

#### 2.1.2 资源管理系统
- 基于 Resource 的资源管理框架已实现
- 支持动态字段定义（文本、邮箱、选择等字段类型）
- 支持表格列定义和筛选器配置
- 支持自定义页面和资源注册

#### 2.1.3 内置管理模块
- 用户管理：支持用户增删改查、状态管理
- 角色管理：支持角色增删改查、权限分配
- 菜单管理：支持菜单增删改查、层级管理
- 操作日志：记录用户操作行为
- 文件管理：基础文件上传功能

#### 2.1.4 API 自动生成
- 基于资源定义自动生成 RESTful API
- 支持标准 CRUD 操作
- 支持数据验证和错误处理
- 支持分页、排序、筛选等功能

### 2.2 前端实现情况
- 基于 Vue3 + AntdvPro 的管理界面已实现
- 动态菜单系统已实现
- 基于资源配置的动态表单和表格渲染已实现
- 国际化支持已集成

## 3. 功能设计

### 3.1 资源管理框架设计

#### 3.1.1 Resource 接口设计
``go
type Resource interface {
    GetTitle() string           // 获取资源标题
    GetSlug() string            // 获取资源标识符
    GetModel() interface{}      // 获取关联的数据模型
    GetFields() []Field         // 获取字段定义
    GetActions() []Action       // 获取支持的操作
    GetReadOnlyFields() []string // 获取只读字段
    GetColumns() []*Column      // 获取表格列定义
    GetFilters() []*Filter      // 获取筛选器定义
}
```

#### 3.1.2 字段系统设计
支持多种字段类型：
- 文本字段 (TextField)
- 邮箱字段 (EmailField)
- 选择字段 (SelectField)
- 数字字段 (NumberField)
- 布尔字段 (BooleanField)
- 日期时间字段 (DateTimeField)
- 文本域字段 (TextareaField)
- 关联字段 (RelationshipField)

#### 3.1.3 表格系统设计
- 支持自定义列定义
- 支持列排序、对齐、宽度设置
- 支持数据格式化显示（徽章、链接等）
- 支持筛选器配置

### 3.2 权限系统设计

#### 3.2.1 RBAC 模型
采用标准的 RBAC 模型，包含以下核心组件：
- 用户 (User)：系统使用者
- 角色 (AdminRole)：权限集合
- 权限 (Permission)：具体操作权限
- 资源 (Resource)：受保护的系统资源

#### 3.2.2 权限控制层级
Resource → Permission → AdminRole → User

#### 3.2.3 字段级权限控制
支持对每个字段设置读写权限，实现精细化控制。

### 3.3 API 自动生成设计

#### 3.3.1 路由结构
```
GET    /api/v1/{resource}          # 获取资源列表
POST   /api/v1/{resource}          # 创建资源
GET    /api/v1/{resource}/{id}     # 获取资源详情
PUT    /api/v1/{resource}/{id}     # 更新资源
DELETE /api/v1/{resource}/{id}     # 删除资源
POST   /api/v1/{resource}/{id}/restore  # 恢复资源
DELETE /api/v1/{resource}/{id}/force    # 强制删除资源
GET    /api/v1/{resource}/export    # 导出资源
DELETE /api/v1/{resource}          # 批量删除资源
POST   /api/v1/{resource}/actions/{action}  # 执行自定义动作
```

#### 3.3.2 功能特性
- 支持分页、排序、筛选、搜索
- 支持数据验证和错误处理
- 支持批量操作
- 支持数据导出

## 4. 开发计划

### 4.1 第一阶段：核心功能完善（1-2周）

#### 4.1.1 权限系统增强
- [ ] 完善字段级权限控制实现
- [ ] 增强角色权限分配界面
- [ ] 实现权限继承机制
- [ ] 添加权限验证中间件

#### 4.1.2 资源管理优化
- [ ] 完善资源字段验证机制
- [ ] 增加更多字段类型支持（文件上传、富文本等）
- [ ] 优化资源列表和表单渲染性能
- [ ] 实现资源间关联关系处理

#### 4.1.3 API 功能增强
- [ ] 完善数据导出功能（支持 Excel、CSV 格式）
- [ ] 实现批量操作功能
- [ ] 增加 API 文档自动生成
- [ ] 优化 API 错误处理和响应格式

### 4.2 第二阶段：系统管理功能（2-3周）

#### 4.2.1 系统设置模块
- [ ] 实现系统配置管理界面
- [ ] 添加邮件配置功能
- [ ] 实现存储配置管理
- [ ] 增加功能开关控制

#### 4.2.2 字典管理模块
- [ ] 实现数据字典管理功能
- [ ] 支持多级字典分类
- [ ] 实现字典缓存机制
- [ ] 添加字典数据接口

#### 4.2.3 日志管理模块
- [ ] 完善操作日志功能
- [ ] 实现系统日志查看
- [ ] 添加日志搜索和筛选功能
- [ ] 实现日志导出功能

### 4.3 第三阶段：高级功能开发（3-4周）

#### 4.3.1 文件管理增强
- [ ] 实现云存储支持（阿里云 OSS、AWS S3）
- [ ] 添加文件预览功能
- [ ] 实现断点续传功能
- [ ] 增加文件分类管理

#### 4.3.2 性能优化
- [ ] 实现数据缓存机制
- [ ] 优化数据库查询性能
- [ ] 添加 API 限流功能

### 4.4 第四阶段：扩展功能和文档完善（1-2周）

#### 4.4.1 代码生成器
- [ ] 完善 CLI 工具功能
- [ ] 实现代码模板自定义
- [ ] 添加生成代码验证功能
- [ ] 完善使用文档

#### 4.4.2 部署和运维
- [ ] 完善 Docker 部署方案
- [ ] 实现 Kubernetes 部署支持
- [ ] 完善备份和恢复机制

#### 4.4.3 文档完善
- [ ] 完善开发者文档
- [ ] 编写用户使用手册
- [ ] 添加 API 接口文档
- [ ] 提供部署和运维指南

## 5. 技术债务和改进点

### 5.1 当前存在的问题
2. 不支持多租户
3. 导入功能未实现
4. 文件上传功能较基础，不支持云存储、分片上传等

### 5.2 改进建议
2. 设计多租户架构，支持 SaaS 模式
3. 实现数据导入功能，支持 Excel、CSV 等格式
4. 增强文件上传功能，支持云存储和分片上传

## 6. 风险评估和应对措施

### 6.1 技术风险
1. 权限系统复杂性可能导致性能问题
   - 应对措施：优化数据库查询，引入缓存机制
   
2. 前后端分离架构可能带来数据一致性问题
   - 应对措施：实现完善的错误处理和数据验证机制

### 6.2 进度风险
1. 功能开发可能超出预期时间
   - 应对措施：采用迭代开发模式，优先实现核心功能

2. 第三方依赖可能影响开发进度
   - 应对措施：选择稳定版本的依赖库，预留集成时间

## 7. 总结

Fun-Admin 项目已经实现了基础的后台管理功能，包括用户认证、权限控制、资源管理等核心模块。基于现有的代码基础和需求文档，我们制定了详细的功能设计和开发计划。

通过四个阶段的开发，我们将逐步完善系统功能，解决当前存在的技术债务，最终实现一个功能完善、性能优良、易于扩展的企业级后台管理系统.